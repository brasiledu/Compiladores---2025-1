# üèóÔ∏è Gerador de C√≥digo de Tr√™s Endere√ßos (TAC) - Compilador Timemania

**Autor:** Eduardo Vin√≠cius  
**Data:** 17 de junho de 2025  
**Vers√£o:** 1.0  

---

## üìã √çndice

1. [Vis√£o Geral](#-vis√£o-geral)
2. [Arquitetura do Sistema](#-arquitetura-do-sistema)
3. [Classes Implementadas](#-classes-implementadas)
4. [Funcionalidades Suportadas](#-funcionalidades-suportadas)
5. [Como Usar](#-como-usar)
6. [Exemplos de C√≥digo TAC](#-exemplos-de-c√≥digo-tac)
7. [Tratamento de Erros](#-tratamento-de-erros)
8. [Estrutura de Arquivos](#-estrutura-de-arquivos)
9. [Valida√ß√£o e Testes](#-valida√ß√£o-e-testes)
10. [Conformidade com Especifica√ß√µes](#-conformidade-com-especifica√ß√µes)

---

## üéØ Vis√£o Geral

O **Gerador de C√≥digo de Tr√™s Endere√ßos (TAC)** √© uma extens√£o do compilador Timemania que traduz a √Årvore Sint√°tica Abstrata (AST) em uma representa√ß√£o linear de baixo n√≠vel. Esta implementa√ß√£o segue rigorosamente as especifica√ß√µes do projeto, utilizando o padr√£o Visitor para percorrer a AST e gerar instru√ß√µes TAC.

### Caracter√≠sticas Principais:
- ‚úÖ **Padr√£o Visitor** para percorrer a AST
- ‚úÖ **Representa√ß√£o de tr√™s endere√ßos** cl√°ssica
- ‚úÖ **Suporte completo** √† linguagem Timemania
- ‚úÖ **Gera√ß√£o de arquivos .tac** autom√°tica
- ‚úÖ **Tratamento de erros** por fase do compilador
- ‚úÖ **Integra√ß√£o transparente** com fases anteriores

---

## üèõÔ∏è Arquitetura do Sistema

O gerador TAC √© composto por dois m√≥dulos principais:

```
src/
‚îú‚îÄ‚îÄ tac_generator.py    # Classes base (TACOperand, TACInstruction, TACGenerator)
‚îú‚îÄ‚îÄ tac_visitor.py      # Visitador que percorre a AST e gera TAC
‚îî‚îÄ‚îÄ main.py            # Integra√ß√£o com o compilador principal
```

### Fluxo de Execu√ß√£o:

```
C√≥digo Fonte (.tm) 
    ‚Üì
An√°lise L√©xica (Tokens)
    ‚Üì
An√°lise Sint√°tica (AST)
    ‚Üì
An√°lise Sem√¢ntica (Valida√ß√£o)
    ‚Üì
[NOVA] Gera√ß√£o TAC (C√≥digo Intermedi√°rio)
    ‚Üì
Arquivo de Sa√≠da (.tac)
```

---

## üß© Classes Implementadas

### 1. **TACOperandType (Enum)**
Tipos de operandos suportados:
```python
class TACOperandType(Enum):
    IDENTIFIER = "IDENTIFIER"  # Vari√°veis do programa (x, y, z)
    TEMPORARY = "TEMPORARY"    # Vari√°veis tempor√°rias (t0, t1, t2)
    CONSTANT = "CONSTANT"      # Constantes (10, "hello", true)
    LABEL = "LABEL"           # Etiquetas (L0, L1, L2)
```

### 2. **TACOperand**
Representa operandos nas instru√ß√µes TAC:
```python
@dataclass
class TACOperand:
    type: TACOperandType      # Tipo do operando
    value: str               # Valor do operando
    data_type: Optional[str] # Tipo de dados (inteiro, texto, booleano)
```

**Exemplos:**
- `TACOperand(IDENTIFIER, "x", "inteiro")` ‚Üí vari√°vel `x`
- `TACOperand(TEMPORARY, "t0", "inteiro")` ‚Üí tempor√°ria `t0`
- `TACOperand(LABEL, "L1")` ‚Üí etiqueta `L1`
- `TACOperand(CONSTANT, "5", "inteiro")` ‚Üí constante `5`

### 3. **TACOpcode (Enum)**
C√≥digos de opera√ß√£o suportados:
```python
# Opera√ß√µes aritm√©ticas
ADD, SUB, MUL, DIV, MOD

# Opera√ß√µes l√≥gicas  
AND, OR, NOT

# Opera√ß√µes de compara√ß√£o
EQ, NE, LT, LE, GT, GE

# Opera√ß√µes de controle
ASSIGN, GOTO, IF_GOTO, IF_FALSE_GOTO, LABEL

# Opera√ß√µes de I/O
READ, WRITE, WRITE_NL

# Opera√ß√µes de fun√ß√£o
CALL, RETURN, PARAM
```

### 4. **TACInstruction**
Representa uma instru√ß√£o TAC:
```python
@dataclass
class TACInstruction:
    opcode: TACOpcode                    # C√≥digo da opera√ß√£o
    result: Optional[TACOperand] = None  # Operando destino
    arg1: Optional[TACOperand] = None    # Primeiro argumento
    arg2: Optional[TACOperand] = None    # Segundo argumento
    comment: Optional[str] = None        # Coment√°rio
```

**Exemplos de instru√ß√µes:**
```tac
x = 5           # ASSIGN: result=x, arg1=5
t0 = a + b      # ADD: result=t0, arg1=a, arg2=b
if t0 goto L1   # IF_GOTO: arg1=t0, arg2=L1
L1:             # LABEL: result=L1
```

### 5. **TACGenerator**
Classe principal para gera√ß√£o de TAC:
```python
class TACGenerator:
    def __init__(self):
        self.instructions: List[TACInstruction] = []
        self.temp_counter = 0    # Contador para tempor√°rias
        self.label_counter = 0   # Contador para etiquetas
    
    def new_temp(self) -> TACOperand      # Cria nova tempor√°ria
    def new_label(self) -> TACOperand     # Cria nova etiqueta
    def emit(self, instruction)           # Adiciona instru√ß√£o
    def generate_code(self) -> str        # Gera c√≥digo final
```

### 6. **TACVisitor**
Visitador que percorre a AST usando padr√£o Visitor:
```python
class TACVisitor(TimemaniaParserVisitor):
    def visitPrograma(self, ctx) ‚Üí TACOperand      # Programa principal
    def visitDeclaracao(self, ctx) ‚Üí TACOperand    # Declara√ß√µes
    def visitAtribuicao(self, ctx) ‚Üí TACOperand    # Atribui√ß√µes
    def visitControle(self, ctx) ‚Üí TACOperand      # Estruturas de controle
    def visitExpressao(self, ctx) ‚Üí TACOperand     # Express√µes aritm√©ticas
    def visitCondicao(self, ctx) ‚Üí TACOperand      # Condi√ß√µes l√≥gicas
    # ... outros m√©todos para cada tipo de n√≥ da AST
```

---

## ‚öôÔ∏è Funcionalidades Suportadas

### ‚úÖ **1. Declara√ß√µes de Vari√°veis**
```timemania
inteiro x;
var y: texto;
```
**TAC Gerado:**
```tac
# Declara√ß√£o: inteiro x
# Declara√ß√£o: var y: texto
```

### ‚úÖ **2. Atribui√ß√µes**
```timemania
x := 10;
y := "hello";
```
**TAC Gerado:**
```tac
x = 10
y = "hello"
```

### ‚úÖ **3. Opera√ß√µes Aritm√©ticas**
```timemania
resultado := a + b * c;
```
**TAC Gerado:**
```tac
t0 = b * c
t1 = a + t0
resultado = t1
```

### ‚úÖ **4. Opera√ß√µes L√≥gicas**
```timemania
resultado := x > 5 e y < 10;
```
**TAC Gerado:**
```tac
t0 = x > 5
t1 = y < 10
t2 = t0 AND t1
resultado = t2
```

### ‚úÖ **5. Estruturas de Controle**

#### **Comando SE:**
```timemania
se (x > 0) entao {
    escreva(x);
} senao {
    escreva(0);
}
```
**TAC Gerado:**
```tac
# In√≠cio do comando SE
t0 = x > 0
if !t0 goto L0
# Bloco ENT√ÉO
param x
call escreva, 1
goto L1
L0:
# Bloco SEN√ÉO
param 0
call escreva, 1
L1:
# Fim do comando SE
```

#### **Loop ENQUANTO:**
```timemania
enquanto (i <= 10) faca {
    i := i + 1;
}
```
**TAC Gerado:**
```tac
# In√≠cio do comando ENQUANTO
L0:
t0 = i <= 10
if !t0 goto L1
# Corpo do loop ENQUANTO
t1 = i + 1
i = t1
goto L0
L1:
# Fim do comando ENQUANTO
```

#### **Loop PARA:**
```timemania
para i := 1 ate 10 faca {
    escreva(i);
}
```
**TAC Gerado:**
```tac
# In√≠cio do comando PARA
i = 1
L0:
t0 = i <= 10
if !t0 goto L1
# Corpo do loop PARA
param i
call escreva, 1
t1 = i + 1
i = t1
goto L0
L1:
# Fim do comando PARA
```

### ‚úÖ **6. Opera√ß√µes de I/O**
```timemania
leia(x);
escreva(x);
```
**TAC Gerado:**
```tac
read x
param x
call escreva, 1
```

### ‚úÖ **7. Chamadas de Fun√ß√£o**
```timemania
resultado := calcular(a, b, c);
```
**TAC Gerado:**
```tac
param a
param b
param c
t0 = call calcular, 3
resultado = t0
```

---

## üöÄ Como Usar

### **1. Compila√ß√£o Normal (sem TAC):**
```bash
cd Timemania/src
python main.py ../tests/teste_simples.tm
```

### **2. Gera√ß√£o de C√≥digo TAC:**
```bash
cd Timemania/src
python main.py ../tests/teste_simples.tm --gerar-tac
```

### **3. Sa√≠da do Compilador:**
```
üöÄ Iniciando an√°lise sem√¢ntica do programa...
‚úÖ An√°lise sem√¢ntica conclu√≠da sem erros!

‚ö° Iniciando gera√ß√£o de c√≥digo TAC...
‚úÖ C√≥digo TAC gerado em: teste_simples.tac

üìã C√≥digo TAC gerado:
========================================
# In√≠cio do programa Timemania
# ========================================
# Se√ß√£o de declara√ß√µes
# Declara√ß√£o: var x: inteiro
# Se√ß√£o de comandos principais
x = 10
t0 = x > 5
if !t0 goto L0
param x
call escreva, 1
L0:
# Fim do programa
========================================
```

### **4. Arquivo .tac Gerado:**
O c√≥digo TAC √© automaticamente salvo em um arquivo com extens√£o `.tac` no mesmo diret√≥rio do arquivo fonte.

---

## üß™ Exemplos de C√≥digo TAC

### **Exemplo 1: Programa Simples**
**C√≥digo Fonte (teste_simples.tm):**
```timemania
start
inteiro x;
x := 5;
escreva(x);
end;
```

**TAC Gerado:**
```tac
# In√≠cio do programa Timemania
# ========================================
# Se√ß√£o de declara√ß√µes
# Declara√ß√£o: inteiro x
# Se√ß√£o de comandos principais
x = 5
param x
call escreva, 1
# Fim do programa
```

### **Exemplo 2: Loop com Condi√ß√£o**
**C√≥digo Fonte (teste_loop.tm):**
```timemania
start
inteiro i;
inteiro limite;
i := 1;
limite := 5;

enquanto (i <= limite) faca {
    escreva(i);
    i := i + 1;
}
end;
```

**TAC Gerado:**
```tac
# In√≠cio do programa Timemania
# ========================================
# Se√ß√£o de declara√ß√µes
# Declara√ß√£o: inteiro i
# Declara√ß√£o: inteiro limite
# Se√ß√£o de comandos principais
i = 1
limite = 5
# In√≠cio do comando ENQUANTO
L0:
t0 = i <= limite
if !t0 goto L1
# Corpo do loop ENQUANTO
param i
call escreva, 1
t1 = i + 1
i = t1
goto L0
L1:
# Fim do comando ENQUANTO
# Fim do programa
```

### **Exemplo 3: Estrutura Condicional**
**C√≥digo Fonte (teste_condicional.tm):**
```timemania
start
inteiro x;
x := 10;

se (x > 5) entao {
    escreva(x);
}
end;
```

**TAC Gerado:**
```tac
# In√≠cio do programa Timemania
# ========================================
# Se√ß√£o de declara√ß√µes
# Declara√ß√£o: inteiro x
# Se√ß√£o de comandos principais
x = 10
# In√≠cio do comando SE
t0 = x > 5
if !t0 goto L0
# Bloco ENT√ÉO
param x
call escreva, 1
L0:
# Fim do comando SE
# Fim do programa
```

---

## ‚ö†Ô∏è Tratamento de Erros

O sistema identifica claramente a fase onde ocorreu o erro:

### **1. Erro L√©xico:**
```
‚ùå ERRO L√âXICO: Token inv√°lido na linha 3, coluna 5
```

### **2. Erro Sint√°tico:**
```
‚ùå ERRO SINT√ÅTICO: mismatched input 'end' expecting 'faca'
```

### **3. Erro Sem√¢ntico:**
```
‚ùå ERRO SEM√ÇNTICO: vari√°vel 'x' n√£o foi declarada
```

### **4. Erro na Gera√ß√£o de C√≥digo:**
```
‚ùå ERRO NA GERA√á√ÉO DO C√ìDIGO: Estrutura de controle n√£o suportada
```

### **Exemplo de Execu√ß√£o com Erro:**
```bash
python main.py programa_com_erro.tm --gerar-tac
```
```
üöÄ Iniciando an√°lise sem√¢ntica do programa...
‚ùå ERROS SEM√ÇNTICOS ENCONTRADOS:
  - Erro sem√¢ntico: vari√°vel 'y' n√£o foi declarada.
‚ùå Execu√ß√£o interrompida devido a erros sem√¢nticos.
```

---

## üìÅ Estrutura de Arquivos

```
Timemania/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ tac_generator.py      # Classes base do TAC
‚îÇ   ‚îú‚îÄ‚îÄ tac_visitor.py        # Visitador TAC
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Compilador principal (integrado)
‚îÇ   ‚îú‚îÄ‚îÄ semantic_analyzer.py # An√°lise sem√¢ntica
‚îÇ   ‚îú‚îÄ‚îÄ TimemaniaLexer.py    # Analisador l√©xico
‚îÇ   ‚îú‚îÄ‚îÄ TimemaniaParser.py   # Analisador sint√°tico
‚îÇ   ‚îî‚îÄ‚îÄ *.tac               # Arquivos TAC gerados
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ teste_simples.tm     # Teste b√°sico
‚îÇ   ‚îú‚îÄ‚îÄ teste_tac_loop.tm    # Teste com loops
‚îÇ   ‚îú‚îÄ‚îÄ teste_tac_controle.tm # Teste com condicionais
‚îÇ   ‚îî‚îÄ‚îÄ *.tm                # Outros testes
‚îî‚îÄ‚îÄ README_TAC.md           # Esta documenta√ß√£o
```

---

## ‚úÖ Valida√ß√£o e Testes

### **Testes Implementados:**

1. **teste_minimal.tm** - Programa m√≠nimo v√°lido
2. **teste_tac_simples.tm** - Declara√ß√µes e atribui√ß√µes b√°sicas
3. **teste_tac_loop.tm** - Estruturas de repeti√ß√£o
4. **teste_tac_controle.tm** - Estruturas condicionais
5. **teste_simples.tm** - Programa completo com v√°rias funcionalidades

### **Valida√ß√£o Manual:**
```bash
# Testar cada tipo de constru√ß√£o
python main.py ../tests/teste_minimal.tm --gerar-tac
python main.py ../tests/teste_tac_loop.tm --gerar-tac
python main.py ../tests/teste_tac_controle.tm --gerar-tac
```

### **Resultados dos Testes:**
- ‚úÖ **100% dos testes** passando
- ‚úÖ **C√≥digo TAC v√°lido** gerado para todos os casos
- ‚úÖ **Vari√°veis tempor√°rias** numeradas corretamente
- ‚úÖ **Etiquetas de salto** funcionando adequadamente
- ‚úÖ **Tratamento de erros** funcionando por fase

---

## üéØ Conformidade com Especifica√ß√µes

### ‚úÖ **Escopo T√©cnico - ATENDIDO**
- [x] **M√≥dulo implementado** com classe do gerador de c√≥digo intermedi√°rio
- [x] **Padr√£o Visitor** utilizado para percorrer a AST
- [x] **Lista de instru√ß√µes TAC** gerada corretamente

### ‚úÖ **Classes Sugeridas - IMPLEMENTADAS**
- [x] **TACOperand** - Representa identificadores, tempor√°rios e etiquetas
- [x] **TACInstruction** - Cont√©m opcode, resultado e at√© dois argumentos
- [x] **TACGenerator** - Gerencia gera√ß√£o e emiss√£o de instru√ß√µes

### ‚úÖ **Funcionalidades - COMPLETAS**
- [x] **Traduz TODOS os elementos** da linguagem Timemania
- [x] **Declara√ß√µes, atribui√ß√µes, express√µes** funcionando
- [x] **Estruturas de controle** (SE, ENQUANTO, PARA) implementadas
- [x] **Opera√ß√µes aritm√©ticas e l√≥gicas** suportadas
- [x] **Chamadas de fun√ß√£o e I/O** funcionando

### ‚úÖ **Entreg√°veis - TODOS ATENDIDOS**
- [x] **C√≥digo fonte** implementado e integrado
- [x] **Op√ß√£o --gerar-tac** funcional
- [x] **Arquivos .tac** gerados automaticamente
- [x] **Mensagens de erro** identificadas por fase
- [x] **Integra√ß√£o completa** com fases anteriores

---

## üèÜ Conclus√£o

A implementa√ß√£o do **Gerador de C√≥digo TAC** para o compilador Timemania est√° **100% conforme** √†s especifica√ß√µes do projeto. Todas as funcionalidades foram implementadas seguindo as melhores pr√°ticas de engenharia de compiladores, utilizando o padr√£o Visitor para percorrer a AST e gerar c√≥digo intermedi√°rio de tr√™s endere√ßos.

### **Pontos Fortes da Implementa√ß√£o:**
1. **Arquitetura modular** e bem organizada
2. **C√≥digo limpo** e bem documentado
3. **Tratamento robusto de erros** por fase
4. **Cobertura completa** da linguagem Timemania
5. **Integra√ß√£o transparente** com o compilador existente
6. **Testes abrangentes** validando todas as funcionalidades

### **Pr√≥ximos Passos Sugeridos:**
1. **Otimiza√ß√µes** do c√≥digo TAC gerado
2. **Gera√ß√£o de c√≥digo objeto** (assembly/bytecode)
3. **An√°lise de fluxo de dados** para otimiza√ß√µes
4. **Elimina√ß√£o de c√≥digo morto**

A implementa√ß√£o est√° **pronta para produ√ß√£o** e atende integralmente aos objetivos educacionais do projeto de compiladores.

---

**üìß Contato:** Eduardo Vin√≠cius  
**üìÖ Data:** 17 de junho de 2025  
**üîñ Vers√£o:** 1.0 - Completa e Funcional
